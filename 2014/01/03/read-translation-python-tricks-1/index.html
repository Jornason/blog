<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><!-- redirect to https by default if we already have weather data--><script>if (document.cookie.search("weatherData") == -1 && window.location.protocol != "http:"){
  window.location.protocol = "http";
}
if (("taoalpha.me" == window.location.host) && (window.location.protocol != "https:") && document.cookie.search("weatherData") != -1) {
  window.location.protocol = "https";
}</script><title> python tricks(1) | TaoAlpha's Blog</title><meta name="description" content="Here is my new blog based on hexo."><meta name="viewport" content="width=device-width, initial-scale=1"><!-- open graph part--><meta property="og:image" content="http://taoalpha.me/images/newblog.jpg"><meta property="og:description" content="TaoAlpha's hexo Blog"><meta property="og:type" content="website"><link rel="short icon" href="/blog/favicon.png"><link rel="stylesheet" href="/blog/css/default.css"></head><body class="blogpost"><aside class="home-menu"><nav class="home-icon-con upside"></nav><a href="/blog/" class="home-menu-icon brand active">涛</a><a href="/blog/tipme" class="home-menu-icon"><i class="fa fa-1x fa-gratipay"></i></a><a href="javascript:$('.searchbox').focus().css('border', '4px dashed #666');setTimeout(function(){$('.searchbox').focus().css('border', 'none').css('border-bottom', '1px solid #ccc')},1000);" class="home-menu-icon"><i class="fa fa-1x fa-search"></i></a><a href="/blog/puzzle" class="home-menu-icon"><i class="fa fa-1x fa-puzzle-piece"></i></a><a href="javascript:;" title="Contact Me" class="home-menu-icon follow">+</a><div class="home-contact"><a href="https://facebook.com/zzgary/" target="something"><img src="https://cdn1.iconfinder.com/data/icons/social-shade-rounded-rects/512/facebook-32.png" alt="facebook"></a><a href="https://github.com/taoalpha/" target="something"><img src="https://cdn1.iconfinder.com/data/icons/social-shade-rounded-rects/512/github-32.png" alt="github"></a><a href="https://taoalpha.me" target="something"><img src="https://cdn3.iconfinder.com/data/icons/colore-sociale/32/mewally_32x32.png" alt="portfolio"></a><a href="https://douban.com/people/129154019" target="something"><img src="https://img3.doubanio.com/favicon.ico" alt="douban"></a></div><nav class="home-icon-con downside"><a href="#contribution" class="home-menu-icon makecontribution"><i class="fa fa-pencil fa-1x"></i></a><a id="togglemusic" href="javascript:;" class="home-menu-icon"><i class="fa fa-music fa-1x"></i></a></nav><div id="musicbar"><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="298" height="40" src=""></iframe></div></aside><div id="contribution" class="hide"><span class="close"></span><input id="sender_mail" type="email" placeholder="Give me your email"><textarea id="contributionContent" name="contribution" cols="30" rows="10" placeholder="Thanks for your contribution!  Now tell me what you want to say: feedback ? advice ? contributions ? Whatever you want ^_^.  I will look at it as soon as I receive it and reply you asap.  "></textarea><input id="sendToMe" type="submit"></div><div class="stars"></div><div class="twinkling"></div><article id="content"><div id="progressbar"><span class="bg"></span><span class="text"></span></div><section class="entry"><h1 class="entry-title"><a href="http://taoalpha.me/blog/2014/01/03/read-translation-python-tricks-1/" title="python tricks(1)">python tricks(1)</a></h1><div class="meta-top"><a href="https://taoalpha.me"><div style="display:inline-block;" class="avatar"><img src="https://avatars3.githubusercontent.com/u/4335753?v=3&amp;s=40" alt="100"></div><span>TaoAlpha</span></a><span>2014-01-03</span><span class="wordage">4662字</span><span class="readspeed">14 分钟读完</span></div><p>无意中发现的一篇文章~ 很有意思, 介绍了不少python的技巧型用法~ <a href="http://www.secnetix.de/~olli/Python/tricks.hawk" target="_blank">原文在此</a></p>
<ul><br>      <li><strong>模拟”?:”的三元运算符</strong><br>  python是不识别C中的”?:”这种三元操作符的,但是模拟这种运算是非常容易的:<br>      x ? y : z —&gt; [z,y][bool(x)]<br>  如果你提前就知道了x的类型, 比如本身就是1,0或者布尔类型, 那么就完全可以不用使用bool()函数了~ 原理? 很简单, 我们只是简单创建了一个列表, 包含两个值, 然后用布尔类型作为索引值来选择list的元素, 其中”true”是等同于1, 而false等同于0, 如此就变成了指定list的第一个还是第二个元素了~<br><br>   注意到在此情况下, x,y,z三个操作数始终都是需要的, 这一点和C里面的”?:”操作符不一样. 如果你需要一个简单方式, 也可以使用if-else来实现.<br><br>   实际上, 还有另一种方法做到这一点, 但是只会在y本身不为false时生效:<br>      x ? y : z —&gt; bool(x) and y or z<br>  (其实就是相当于与运算, 如果x,y都为真,那么就是y(因为bool(x)=1),如果bool(x)为假且y为真时, 就是z~)<br>  </li><br>      <li><strong>如何查看python的版本.</strong><br>  其实很多时候经常发现自己用到的一些功能在旧版本的python中不支持. 这个时候如果在旧版本中运行了, 就会出现一个非常恶心的exception traceback….而通常它的错误信息都是非常无用的…在此情况中, 你就可以用一个简单的脚本来解决~<br><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">import</span> <span class="tag">sys</span></span><br><span class="line"><span class="tag">if</span> <span class="tag">not</span> <span class="tag">hasattr</span>(<span class="tag">sys</span>, "<span class="tag">hexversion</span>") <span class="tag">or</span> <span class="tag">sys</span><span class="class">.hexversion</span> &lt; 0<span class="tag">x020300f0</span>:</span><br><span class="line">    <span class="tag">sys</span><span class="class">.stderr</span><span class="class">.write</span>("<span class="tag">Sorry</span>, <span class="tag">your</span> <span class="tag">Python</span> <span class="tag">is</span> <span class="tag">too</span> <span class="tag">old</span>.\<span class="tag">n</span>")</span><br><span class="line">    <span class="tag">sys</span><span class="class">.stderr</span><span class="class">.write</span>("<span class="tag">Please</span> <span class="tag">upgrade</span> <span class="tag">at</span> <span class="tag">least</span> <span class="tag">to</span> 2<span class="class">.3</span>.\<span class="tag">n</span>")</span><br><span class="line">    <span class="tag">sys</span><span class="class">.exit</span>(1)</span><br></pre></td></tr></table></figure><br><br>将这一段代码放在你的程序的最顶部, 包括其他的import语句都要放在其下方. 其中hexversion代表的是一个旨在1.5.2的python之后出现的变量, 由此预防有人使用比1.5.2还早的版本. 这个变量的格式0x&lt;maj&gt;&lt;min&gt;&lt;rev&gt;&lt;rel&gt;(major,minor以及revision和一个发布状态的指示符,官方一般是f0),每四个字符是两个16进制数位.<br>  </li><br>      <li><strong>调试CGIs.</strong><br>     从python2.2版本后使用的cgitb库是一个非常好用的工具, 尤其是在调试CGI程序时. 任何时候每当run-time错误比如exception发生时, 一个很好的html文件就会创建, 包含了错误发生的位置以及源代码, 行号甚至其中涉及的变量. 为了使用这个模块, 只需要把这行代码放在你的CGI程序上方即可.<br><br><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">import</span> <span class="tag">cgitb</span>; <span class="tag">cgitb</span><span class="class">.enable</span>()</span><br></pre></td></tr></table></figure><br><br><br>  </li><br><br><br>    <li><strong>列表元素的并行排序</strong><br>      有时候你需要对一个列表元素进行排序, 同时还有第二个列表(同等长度)需要一起排序. 当然, 你可以一开始就使用一个2元数构成的列表, 但有的时候程序要求使用别的格式…所以还是可能发生的, 无论如何, 这样也很简单~ 如下的代码片段就可以适用于2个甚至更多的列表~<br><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">data = zip(list1, list2)</span><br><span class="line">data.sort()</span><br><span class="line">list1, list2 = map(lambda t: list(t), zip(*data))</span><br></pre></td></tr></table></figure><br><br>      注意到zip()函数返回的就是一个包含数组的列表, 所以最后你需要把zip()后的数据再次拆分一下~ 这也是map()函数以及lambda函数的作用. 如果你实际上不需要列表,那么完全可以把最后一行简化为:<br><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">tuple1, tuple2 = zip(*data)</span><br></pre></td></tr></table></figure><br><br>  </li><br>    <li><strong>转换Mac地址</strong><br>          我发现我自己经常转换MAC地址…有时候叫它以太网地址…到一个标准格式. 比如: 每6个部分代表2个数位, 而且都是用的小写的16进制字节. 也是很简单的~<br><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mac = ":".join([i.zfill(2) for i in mac.split(":")]).lower()</span><br></pre></td></tr></table></figure><br><br>      zfill()函数是在python 2.2.2之后引入的, 是针对字符串操作的一个函数.<br>  </li><br>    <li><strong>针对IP地址排序</strong><br>  如何对一个代表着IP地址的字符串列表进行排序呢? 当然, 你可以针对sort()函数做一些简单调整, 但是那会是非常低效率的.<br><br>      更好的处理方法是能够利用内置好的比对函数来对列表做预处理, 然后再次把它转回原来的格式. 这个技巧可以处理很多情况, 不止是IP地址~<br><br>      在本例中还是使用IP地址, 我们首先把每个IP地址重新格式化, 每四个八位字节占据三个字符的域, 如果需要可以在前补充空格. 这样每部分都有同样的长度且可以比较了, 而且有现成的比对函数, 之后就是把它再调回之前的格式就行了~<br><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">for i in range(len(ips)):</span><br><span class="line">    ips[i] = "%3s.%3s.%3s.%3s" % tuple(ips[i].split("."))</span><br><span class="line">ips.sort()</span><br><span class="line">for i in range(len(ips)):</span><br><span class="line">    ips[i] = ips[i].replace(" ", "")</span><br></pre></td></tr></table></figure><br><br><br>  </li><br>    <li><strong>解析命令行选项</strong><br>  如下是一个关于解析命令选项的代码片段, 使用的是getopt库, 而且是一种相对比较复杂的方式…在本例中, 程序会接受3个参数, 同时需要至少两个参数.<br><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import sys, getopt, os.path</span><br><span class="line">me = os.path.basename(sys.argv[0])</span><br><span class="line"></span><br><span class="line">debug   = False</span><br><span class="line">really  = True</span><br><span class="line">verbose = False</span><br><span class="line"></span><br><span class="line">my_options = (</span><br><span class="line">    ("d", "debug",     "debug   = True",  "Enable debug mode."),</span><br><span class="line">    ("n", "notreally", "really  = False", "No action, display only."),</span><br><span class="line">    ("v", "verbose",   "verbose = True",  "Increase verbosity.")</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">short_opts = reduce(lambda a, b: a + b[0], my_options, "")</span><br><span class="line">long_opts  = map(lambda x: x[1], my_options)</span><br><span class="line"></span><br><span class="line">def usage ():</span><br><span class="line">    args = "[-%s] &lt;dir1&gt; &lt;dir2&gt; [...]" % short_opts</span><br><span class="line">    print &gt;&gt; sys.stderr, "Usage: ", me, args, "\nOptions:"</span><br><span class="line">    for opt in my_options:</span><br><span class="line">        print &gt;&gt; sys.stderr, "-" + opt[0], opt[3]</span><br><span class="line">    sys.exit(1)</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    opts, args = getopt.getopt(sys.argv[1:], short_opts, long_opts)</span><br><span class="line">except getopt.GetoptError:</span><br><span class="line">    usage()</span><br><span class="line"></span><br><span class="line">for o, p in opts:</span><br><span class="line">    for shrt, lng, action in my_options:</span><br><span class="line">        if o[1:] in shrt or o[2:] == lng:</span><br><span class="line">            exec action</span><br><span class="line">            break</span><br><span class="line">    else:</span><br><span class="line">        usage()</span><br><span class="line"></span><br><span class="line">if len(args) &lt; 2:</span><br><span class="line">    usage()</span><br></pre></td></tr></table></figure><br><br><br>  </li><br>    <li><strong>python与shell的结合</strong><br><br>    有时候写一个既可以用于shell的也可以用于python的脚本会非常有帮助的. 这也是可行的, 技巧就是: 在shell中四个引号的序列作为代表引用, 而在python中用3个引号. 所以你可以把shell命令嵌套在一个三个引号中. 注意一般最开始的字符代表的都是这个模块或者脚本的doc信息, 所以通常会被python的编译所忽略.<br><br>如下的例子中演示了这一技巧. 首先它是作为一个shell脚本(因为在首行声明了#!/bin/sh). 然后嵌套的shell命令会检查是否安装了python. 如果没有的话, 就会出现一个非常有意义的错误信息, 同时脚本退出. 如果有的话, 脚本会再次用python执行. python会忽略所有包含在三个引号内的注释信息,同时执行剩下的部分.<br><br>如果你希望能有一个真实的doc信息, 你必须在之后声明它.如下:<br><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#!/bin/sh</span><br><span class="line"></span><br><span class="line">"""":</span><br><span class="line">if which python &gt;/dev/null; then</span><br><span class="line">    exec python "$0" "$@"</span><br><span class="line">else</span><br><span class="line">    echo "$&#123;0##*/&#125;: Python not found. Please install Python." &gt;&amp;2</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">__doc__ = """</span><br><span class="line">Demonstrate how to mix Python + shell script.</span><br><span class="line">"""</span><br><span class="line"></span><br><span class="line">import sys</span><br><span class="line">print "Hello World!"</span><br><span class="line">print "This is Python", sys.version</span><br><span class="line">print "This is my argument vector:", sys.argv</span><br><span class="line">print "This is my doc string:", __doc__</span><br><span class="line">sys.exit (0)</span><br></pre></td></tr></table></figure><br><br></li><br>    <li><strong>把signal numbers转换为names</strong><br>    不幸的是在signal模块中并不存在一个转换signal number到signal name的函数, 虽然通常来说这会很有帮助. 如下的函数可以做到这一点:<br><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">import signal</span><br><span class="line"></span><br><span class="line">def signal_numtoname (num):</span><br><span class="line">    name = []</span><br><span class="line">    for key in signal.__dict__.keys():</span><br><span class="line">        if key.startswith("SIG") and getattr(signal, key) == num:</span><br><span class="line">            name.append (key)</span><br><span class="line">    if len(name) == 1:</span><br><span class="line">        return name[0]</span><br><span class="line">    else:</span><br><span class="line">        return str(num)</span><br></pre></td></tr></table></figure><br><br></li><br><br></ul>


<aside class="tipme special"><a href="/blog/tipme" class="tipme">If you like my work, buy me a soda or send me a book ! ^_^</a></aside></section><aside class="sidenav"><input type="text" placeholder="Enter to search" class="st-default-search-input searchbox"></aside><div class="relatedposts sidenav"><h2>Related Posts:</h2><ul class="article-list"><li><a href="http://taoalpha.me/blog/2014/07/24/read-yi-high-performance-browser-networking-1-preface/">High-Performance Browser Networking .1.Preface</a></li><li><a href="http://taoalpha.me/blog/2015/03/08/read-what-is-pythonic/">What is Pythonic?</a></li><li><a href="http://taoalpha.me/blog/2015/02/16/read-reloading-python-modules/">Reloading Python Modules</a></li><li><a href="http://taoalpha.me/blog/2014/12/05/read-read-a-brief-history-of-web-design/">网页设计简史</a></li><li><a href="http://taoalpha.me/blog/2014/12/04/read-read-google-did-a-good-thing-kill-annoying-type-identification-code/">Google又做了一件大好事:干掉了烦人的识别型验证码!</a></li></ul></div><aside class="sidenav"><div class="recentposts"><h2>Recent Posts:</h2><ul class="article-list"><li><a href="http://taoalpha.me/blog/2016/02/11/tech-add-ssl-to-your-github-pages-with-customized-domain/">Add SSL to your github pages with customized domain</a></li><li><a href="http://taoalpha.me/blog/2016/01/19/tech-sorting-algorithm-in-javascript-median-sort-and-quicksort/">Sorting Algorithm in JavaScript - Quicksort and Heap Sort</a></li><li><a href="http://taoalpha.me/blog/2016/01/16/oj-oj-leetcode-numbers-1/">OJ LeetCode Numbers 1</a></li><li><a href="http://taoalpha.me/blog/2016/01/16/tech-add-a-reading-progressbar-to-your-blog/">Add a reading progressbar to your blog</a></li><li><a href="http://taoalpha.me/blog/2016/01/16/oj-oj-leetcode-substring-questions-1/">OJ LeetCode Substring Questions 1</a></li></ul></div></aside><div class="comments"><div data-thread-key="2014/01/03/read-translation-python-tricks-1/" data-title="python tricks(1)" data-url="http://taoalpha.me/blog/2014/01/03/read-translation-python-tricks-1/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"taoalpha"};
(function() {
  var ds = document.createElement('script');
  ds.type = 'text/javascript';ds.async = true;
  ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
  ds.charset = 'UTF-8';
  (document.getElementsByTagName('head')[0] 
   || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script></div></article><div class="notification fail hidden"></div><!-- jquery--><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-46725017-2",'auto');ga('send','pageview');</script><script>(function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
(w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
})(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
_st('install','CUMLELEvkSRAFuVehSCm','2.0.0');</script><!-- main functions--><script src="/blog/js/functions.js"></script><script src="/blog/js/default.js"></script><script src="/blog/js/post.js"></script></body></html>