<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <title>jekyll中如何做中文字数统计 | TaoAlpha's Blog</title>
    <meta name="author" content="taoalpha" />
    <meta name="renderer" content="webkit">
    <meta name="description" content="TaoAlpha's Blog" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="/css/default.css" type="text/css" />
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
    <link rel="alternate" type="application/atom+xml" title="Recent Entries" href="" />
    <script src="/js/jquery-1.7.1.min.js" type="text/javascript"></script>
    <script src="/js/jquery.cookie.js" type="text/javascript"></script>
    <script src="/js/functions.js" type="text/javascript"></script>
</head>


<body>

  <!--[if lt IE 9]>
  <script type="text/javascript">
    document.createElement("nav"); 
    document.createElement("header"); 
    document.createElement("footer"); 
    document.createElement("section"); 
    document.createElement("aside"); 
    document.createElement("article");
  </script>
  <![endif]-->
  <section class="home-menu">
    <nav class="home-icon-con upside">
        <a class="home-menu-icon brand active" href="/blog">涛</a>
        <a class="home-menu-icon" href="/tech"><i class="fa fa-wrench fa-1x"></i></a>
        <a class="home-menu-icon" href="/dandp"><i class="fa fa-heartbeat fa-1x"></i></a>
        <a class="home-menu-icon" href="/mylinks"><i class="fa fa-anchor fa-1x"></i></a>
        <a class="home-menu-icon follow" href="#" title="Contact Me">+</a>
    </nav>
    <div class="home-contact">
        <a href="http://facebook.com/taoalpha/" target="_blank"><img src="http://www.weibo.com/favicon.ico" alt="" width="25"/></a>
        <a href="http://www.douban.com/people//" target="_blank" ><img src="http://www.douban.com/favicon.ico" alt="" width="22"/></a>
        <a href="http://instagram.com//" target="_blank"><img src="http://d36xtkk24g8jdx.cloudfront.net/bluebar/00c6602/images/ico/favicon.ico" alt="" width="22"/></a>
    </div>

    <nav class="home-icon-con downside">
        <a class="home-menu-icon" href="https://github.com/taoalpha/taoalpha.github.com/tree/master/blog/_posts/blog"><i class="fa fa-pencil fa-1x"></i></a>
        <a class="home-menu-icon" href="/blog"><i class="fa fa-sign-in fa-1x"></i></a>
    </nav >
</section>


  <link rel="stylesheet" href="/js/prettify/prettify.css" />
<div id="content">
    <div class="entry">
        <h1 class="entry-title"><a href="/2015/05/21/jekyll-count-of-chinese-characters.html" title="jekyll中如何做中文字数统计">jekyll中如何做中文字数统计</a></h1>
        
        <div class="meta-top">
            <a href="/users/taoalpha">
                <div class="avatar" style="display:inline-block;"><img src="https://avatars3.githubusercontent.com/u/4335753?v=3&s=40" alt="100"></div>
                <span>TaoAlpha</span>
            </a>        
            <span>2015-05-21</span>
            <span class="wordage">1776 字 </span>
            <span class="readspeed">5 分钟读完 </span>
        </div>
        <p>这两天又优化了以下blog, 首先是给天气部分加上了cookie和定位控制, 这样一方面能减少对openweather的请求次数, 同时优化加载的速度, 另一方面也能更加智能化的显示天气. 当然, 为了防止定位错误的问题, 我也同时增加了自定义位置的功能, 同样给予了cookie记录. 具体的实现方法, 这里就不多说了, 也很简单.</p>

<p>本文主要是介绍下jekyll中如何实现中文的字数统计. 为什么要做字数统计呢? 还是来源于<a href="http://www.jianshu.com/p/613916eea37f">简书-文章页</a>, 里面详细的记录了作者的信息以及当前文章的字数. 再加上一个实时统计的阅读次数, 当然对我而言, 这个实时阅读次数意义不大, 我就顺着字数统计改成了阅读时间估计. 恩, 没错, 又是模仿<a href="https://medium.com/">medium</a>的~ ಥ_ಥ</p>

<h2 id="section">字数统计方法</h2>

<p>如何统计一段文本的字数是有很多种方法的, 但是因为语言文字的不同, 很多时候, 不同的方法对不同的语言文字适用性是不一样的. 目前来说, 通常有以下几种字数统计方案:</p>

<ul>
  <li>根据常规的一个中文字符等于两个英文字母的概念, 通过获取整个文本的长度(比如js中的length), 除以2就可以获得一个粗略的值了, 如果要精确些, 可以在上述方法的基础上加入<code>charCodeAt()</code>来判断字符属性是中文还是英文字母, 然后区分计算;</li>
  <li>如果是纯英文, 通常统计的都是词数而非字数, 而英文天然的空格分词, 也让统计其词数非常容易, 只需要按照空格切分获取长度即可;</li>
  <li>如果是纯中文, 我们统计的则多数是字数, 这种情况下, 因为中文缺少类似英文空格这种天然的切分符号, 就不能单纯的使用切分法来获取字数了, 可以借鉴第一种方法所述, 通过去除换行以及标签符号, 然后获取最后的数组大小来实现;</li>
  <li>如果是中英文混杂, 那么同样可以使用上述方法获得粗略数值, 当然, 如果你需要精确的话, 也需要对文本字符属性做判断来区分处理;</li>
</ul>

<h3 id="jekyll">jekyll中的词数统计</h3>

<p><code>number_of_words</code>是jekyll中已有的一个词数统计过滤器, 可以很方便的统计出文本的英文词数, 但对中文就不适用了… 因为它本身是根据空格, 标点符号等来切分统计的, 有的时候甚至连英文都可能不准确…</p>

<h3 id="section-1">取巧的统计方式</h3>

<p>jekyll支持的众多filter中, 有这么一个<code>size</code>, 是可以返回一个数组的大小的, 而且能够正确的理解类似中文GBK的编码的. 于是我们可以使用类似:</p>

<div class="highlight"><pre><code class="language-liquid" data-lang="liquid">Approximate number of English words: <span class="p">{{</span><span class="w"> </span><span class="nv">text</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">split</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot; &quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">size</span><span class="w"> </span><span class="p">}}</span>
Approximate number of Chinese words: <span class="p">{{</span><span class="w"> </span><span class="nv">text</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">split</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="nf">size</span><span class="w"> </span><span class="p">}}</span>
// 可以看到都是近似值~ 如果你对精度要求没那么高, 那么基本是够用了~
// 实际上, 因为本身size支持文本, 所以对中文这里可以不用split: &quot;&quot;的</code></pre></div>

<p>那么回过头, 我们如果要统计content里面的中文字数就可以利用<code>size</code>这个方法了. 不过考虑到content里面有很多html的tag, 我们为了更加接近真实数值, 可以借用<code>strip_html</code>以及<code> strip_newlines</code>两个过滤器来去除所有的html tag和空行. 那么最终的代码就是:</p>

<div class="highlight"><pre><code class="language-liquid" data-lang="liquid">{ { content | strip_html | strip_newlines | size } }</code></pre></div>

<p>其实在jekyll的github issue中有人已经问过类似的问题<a href="https://github.com/jekyll/jekyll/issues/1921">jekyll的中文切分问题</a>.</p>

<h2 id="section-2">阅读速度问题</h2>

<p>既然获得了字数, 那么想要获得阅读时间就很容易了, 通常英文单词的阅读速度在350wpm(词每分钟), 而中文也是基本接近的350字每分钟左右. 那么这次利用<code>divided_by</code>以及<code>round</code>两个函数就可以获得一个大致的分钟数了:
(有兴趣的可以前往参考来源的第二条中看关于中文, 英文阅读速度的一篇文章)</p>

<div class="highlight"><pre><code class="language-liquid" data-lang="liquid">{ content | strip_html | strip_newlines | size | divided_by:350 | round}}</code></pre></div>

<h2 id="section-3">参考来源</h2>

<ul>
  <li><a href="https://github.com/jekyll/jekyll/issues/1921">jekyll的中文切分问题</a></li>
  <li><a href="http://persquaremile.com/2011/12/21/which-reads-faster-chinese-or-english/">Which reads faster, Chinese or English?</a></li>
</ul>


    </div>

    <div class="sidenav">
        <h2>All</h2>
        <ul class="article-list">
        
            <li><a href="/2015/05/26/filesystem-recovery-from-time-machine.html">利用TM进行系统二进制文件恢复</a></li>
        
            <li><a href="/2015/05/25/dns-parse.html">更换DNS解析</a></li>
        
            <li><a href="/2015/05/21/mi-band.html">小米手环体验一周感受</a></li>
        
        </ul>

        <h2>Tech</h2>
        <ul class="article-list">
        
            <li><a href="/2015/05/22/Cookie-path.html">Cookie中path规则介绍</a></li>
        
            <li><a href="/2015/05/21/jekyll-count-of-chinese-characters.html">jekyll中如何做中文字数统计</a></li>
        
            <li><a href="/2015/05/12/js-date-to-chinese.html">JS实现中文日期的方法</a></li>
        
        </ul>

        <h2>D&P</h2>
        <ul class="article-list">
        
            <li><a href="/2015/05/08/design-psychology-1-cyber-psychology.html">设计心理学系列(1) - 网络心理学</a></li>
        
        </ul>
    </div>
    
<div class="comments">
    <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="/2015/05/21/jekyll-count-of-chinese-characters" data-title="jekyll中如何做中文字数统计 - TaoAlpha's Blog" data-url="/2015/05/21/jekyll-count-of-chinese-characters.html - http://taoalpha.github.io"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
        var duoshuoQuery = {short_name:'taoalpha'};
        (function() {
            var ds = document.createElement('script');
            ds.type = 'text/javascript';ds.async = true;
            ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
            ds.charset = 'UTF-8';
            (document.getElementsByTagName('head')[0] 
             || document.getElementsByTagName('body')[0]).appendChild(ds);
        })();
        </script>
    <!-- 多说公共JS代码 end -->
</div>


</div>

<script src="/js/post.js" type="text/javascript"></script>


<script type="text/javascript" src="/js/default.js"></script>
</body>
</html>
