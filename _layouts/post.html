---
layout: default
pname: blogpost
---

{% stylesheet syntax %}
<article id="content">
    <section class="entry">
        <h1 class="entry-title"><a href="{{ page.url }}" title="{{ page.title }}">{{ page.title }}</a></h1>
        {% assign author = site.authors[page.author] %}
        <div class="meta-top">
            <a href="/blog/user/{{ page.author }}">
                <div class="avatar" style="display:inline-block;"><img src="{{ author.avatar }}" alt="100"></div>
                <span>{{ author.display_name }}</span>
            </a>        
            <span>{{ page.date|date:"%Y-%m-%d" }}</span>
            <span class="wordage">{{ content | strip_html | strip_newlines | size }} 字 </span>
            <span class="readspeed">{{ content | strip_html | strip_newlines | size | divided_by:350 | round}} 分钟读完 </span>
        </div>
        {{ content }}
        {% if page.function != "tipme" %}
        {% include tipme.html %}
        {% endif %}
    </section>

    <aside class="sidenav">
      {% assign postsAfterFilter = '-' | split: "-" %}
      {% assign tagCountEachPost = '-' | split: "-" %}
      {% for post in site.related_posts %}
        {% assign commonTagCount = 0 %}
        {% if post.title != page.title or post.series != page.series %}
          {% for tag in post.tags %} 
            {% if page.tags contains tag %}
              {% assign commonTagCount = commonTagCount | plus: 1 %}
            {% endif %}
          {% endfor %}
          {% if commonTagCount > 0 %}
            {% assign postsAfterFilter = postsAfterFilter | push: post %}
            {% assign tagCountEachPost = tagCountEachPost | push: commonTagCount %}
          {% endif %}
        {% endif %}
      {% endfor %}

      {% if postsAfterFilter.size > 0 %}
      <div class="relatedposts">
        <h2>Related Posts:</h2>
        <ul class="article-list">
      {% assign j = tagCountEachPost | size | minus: 1 %}
      {% assign maxIndex = 0 %}
      {% assign getFirstNumber = true %}
      {% assign selectedIndex = "-"|split: "-" %}
      {% for p in (0..j) %}
        {% for i in (0..j) %}
          {% unless selectedIndex contains i %}
            {% if getFirstNumber %}
              {% assign firstNumber = tagCountEachPost[i] %}
              {% assign getFirstNumber = false %}
            {% endif %}
            {% if tagCountEachPost[i] >= firstNumber %}
              {% assign firstNumber = tagCountEachPost[i] %}
              {% assign maxIndex = i %}
            {% endif %}
          {% endunless %}
        {% endfor %}
        {% assign getFirstNumber = true %}
        {% assign selectedIndex = selectedIndex | push: maxIndex %}
        {% if selectedIndex.size < 6 %}
          <li><a href="{{ site.baseurl }}{{ postsAfterFilter[maxIndex]['url'] }}">{{ postsAfterFilter[maxIndex]['title'] }}</a></li>
        {% endif %}
      {% endfor %}
      </ul>
      </div>
      {% endif %}

      {% comment %} {% assign postsAfterFilter = postsAfterFilter | sort_by_array: {{tagCountEachPost}} %} {% endcomment %}
      <div class="recentposts">
        <h2>Recent Posts:</h2>
        <ul class="article-list">
        {% for post in site.posts limit:5 %}
          {% if post.title != page.title %}
          <li><a href="{{ site.baseurl }}{{ post.url }}">{{ post.title }}</a></li>
          {% endif %}
        {% endfor %}
        </ul>
      </div>
    </aside>

    {% include duoshuo.html %}

</article >

{% javascript post %}
